<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WeakRef 介绍</title>
</head>
<body>
    <script>
        // ES6 Set Map

        // ES6 WeakSet WeakMap ES12 WeakRef

        // 垃圾回收机制

        let obj = {
            name: "ich"
        }

        // obj 地址赋值给 obj1，即使 obj被赋值null，
        // 也可以对obj1对相应的对象内的属性方法访问
        // let obj1 = obj
        // obj 的地址指向 null，无法对obj进行查询，修改，删除等操作
        // obj = null
        // obj1 垃圾回收机制没法回收，会导致内存信息泄露

        // --------

        let s1 = new Set()
        
        // s1 存的是 obj的引用
        s1.add(obj)
        
        s1.add("aaaa")
        
        obj = null
        // 设置为 null 后,s1里面的obj无法对它进行任何操作

        // 只是可以通过for循环索引找到obj,但是仍然无法对其操作
        for (let i of s1) {
            console.log(i);
        }

        // 一旦这些无法删除的积累多了,会有内存泄漏的隐患
        // 垃圾回收机制没有理由回收

        // ------- WeakSet -------
        /*
            weakset:
                1. 只能复杂类型
                2. 不存在引用计数 +1
                3. size,for循环不能使用
        */

        let obj2 = {
            name: "du"
        }

        let s2 = new WeakSet()
        s2.add(obj2)

        obj2 = null

        // 不可以存储基本类型的数据
        // s1.add("aaaa")
    </script>
</body>
</html>